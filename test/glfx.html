<!DOCTYPE html>
<html>
<head>
	<title>glfx</title>
	<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.1.0/jquery.min.js"></script>
	<style type="text/css">
		body {
			margin: 0;
			padding: 0;
			overflow-y:scroll;
			overflow-x: hidden;
			width: 1280px;
			height: 8296px;
		}
		#image {
			position: fixed;
			top:0;
			left:0;
			width:100vw;
			height: 100vh;
		}
	</style>
</head>
<body>
	<canvas id="canvasCrop" width="1280" height="622" style="display:none"></canvas>
	<img id="image" src="abc.jpg">



	<script src="glfx.js"></script>
	<script>

	var dataURL;

    // try to create a WebGL canvas (will fail if WebGL isn't supported)
    // try {
    var canvas = fx.canvas();
    // } catch (e) {
    //     alert(e);
    //     // return;
    // }

    // convert the image to a texture
    var image = document.getElementById('image');

    $(window).scroll(function() {
			scrollupdate();
		});

    scrollupdate();

    function scrollupdate () {
    	
    fishfuck();

    var tryimg = new Image();
    tryimg.src = dataURL;

    console.log(tryimg.src);

    var texture = canvas.texture(tryimg);

    console.log(texture);
    // apply the ink filter
    // canvas.draw(texture).ink(0.25).update();
    setTimeout(function () {
    	canvas.draw(texture).bulgePinch($(window).width/2, $(window).height/2, 354, -0.5).update();
    }, 500)
    // var dataimg = new Image();
    // dataimg.src = canvas.toDataURL();

    console.log(canvas);

    image.src = canvas.toDataURL('image/png');
    // var canorg = document.getElementById('canvas');
    // canorg.width = 1280;
    // canorg.height = 622;

    // canorg.draw(dataimg);
    // replace the image with the canvas
    // image.parentNode.insertBefore(canvas, image);
    // image.parentNode.removeChild(image);
	}

    function fishfuck () {

    	var canvasCrop = document.getElementById('canvasCrop');
    	var context = canvasCrop.getContext('2d');
    	var imageObj = new Image();
    	imageObj.src = 'moses.jpg';

        // draw cropped image
        var sourceX = 0;
        var sourceY = $(window).scrollTop();
        var sourceWidth = 1280;
        var sourceHeight = 622;
        var destWidth = sourceWidth;
        var destHeight = sourceHeight;
        var destX = canvasCrop.width / 2 - destWidth / 2;
        var destY = canvasCrop.height / 2 - destHeight / 2;
        context.drawImage(imageObj, sourceX, sourceY, sourceWidth, sourceHeight, 0, 0, destWidth, destHeight);

        dataURL = canvasCrop.toDataURL();

        // if (dataURL!=undefined) {
        // 	console.log(dataURL);
        // };
    }

</script>
</body>
</html>